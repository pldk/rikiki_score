<%= turbo_frame_tag "prediction_#{round.id}_#{player.id}" do %>
  <%= simple_form_for [game, round, Prediction.new],
        data: { controller: "auto-submit", turbo_frame: "prediction_#{round.id}_#{player.id}" } do |f| %>
    <% if prediction.errors.any? %>
      <div class="text-red-600 text-sm mb-1 font-semibold">
        ‚ö†Ô∏è <%= prediction.errors.full_messages.to_sentence %>
      </div>
    <% end %>
    <%= f.hidden_field :player_id, value: player.id %>

    <div class="flex items-center gap-2">
      <%= f.input :predicted_tricks,
            collection: (0..round.length),
            label: false,
            prompt: "üèπ",
            input_html: { class: "w-20 rounded-lg text-center border-gray-300 dark:bg-gray-700 dark:text-white",
                          data: { action: "change->auto-submit#submit" } } %>

      <% star_disabled = Prediction.joins(:round)
          .where(player_id: player, is_star: true)
          .where(rounds: { game_id: game.id })
          .any? { |p| p.round.phase == round.phase && p.id != prediction.id } %>

      <%= f.input :is_star,
            as: :boolean,
            label: "‚≠êÔ∏è",
            input_html: { class: "w-4 h-4 text-yellow-500 border-gray-300 rounded",
                          data: { action: "change->auto-submit#submit" },
                          disabled: star_disabled } %>

      <%= f.submit "Go",
            class: "px-3 py-1 text-xs font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700" %>
    </div>
  <% end %>
<% end %>
